@using NatureQuestWebsite.Models
@inherits Umbraco.Web.Mvc.UmbracoViewPage<ProductCategoriesModel>
@{
    //check if we have any categories to use
    if (Model.ProductCategories.Any())
    {
        <section class="container padding-top-1x padding-bottom-1x">
            <h3 class="text-center mb-30 text-primary text-uppercase">
                Product Categories
            </h3>
            <div class="row">
                @foreach (var category in Model.ProductCategories)
                {
                    //get 3 products to list
                    var categoryProducts = category.CategoriesProducts.Take(3);
                    <div class="col-md-4 col-sm-6">
                        <div class="widget widget-featured-products">
                            <h3 class="widget-title">
                                <a href="@category.CategoryLinkUrl" title="@category.CategoryLinkTitle">
                                    @category.CategoryLinkTitle
                                </a>
                            </h3>

                            @foreach (var product in categoryProducts)
                            {
                                var productPage = product.ProductPage;
                                var productFirstImage = product.ProductImages.FirstOrDefault();
                                //get the 1st normal price
                                var productFeaturedPrice = product.ProductPrices.FirstOrDefault();
                                var salePrice = product.SalePrice;
                                //check if we have a variant image
                                if (!string.IsNullOrWhiteSpace(productFeaturedPrice?.ProductVariantImage?.ImageUrl))
                                {
                                    productFirstImage = productFeaturedPrice.ProductVariantImage;
                                }

                                if (!string.IsNullOrWhiteSpace(productFirstImage?.ImageUrl))
                                {
                                    <div class="entry">
                                        <div class="entry-thumb">
                                            <a href="@productPage.Url" title="@product.ProductTitle">
                                                <img src="@productFirstImage.ImageUrl" alt="@productFirstImage.ImageAltText">
                                            </a>
                                        </div>
                                        <div class="entry-content">
                                            <h4 class="entry-title">
                                                <a href="@productPage.Url" title="@product.ProductTitle">
                                                    @product.ProductTitle
                                                </a>
                                            </h4>
                                            @if (salePrice != null && salePrice.SalePrice > 0)
                                            {
                                                <span class="entry-meta">
                                                    <del>@salePrice.ProductPrice.ToString("c")</del>
                                                    @salePrice.SalePrice.ToString("c")
                                                </span>
                                            }
                                            else if (productFeaturedPrice != null)
                                            {
                                                <span class="entry-meta">
                                                    From @productFeaturedPrice.ProductPrice.ToString("c")
                                                </span>
                                            }
                                        </div>
                                    </div>
                                }
                            }
                            <a class="btn btn-outline-primary btn-sm" href="@category.CategoryLinkUrl" title="@category.CategoryLinkTitle">
                                View All
                            </a>
                        </div>
                    </div>
                }
            </div>
        </section>
    }
}
